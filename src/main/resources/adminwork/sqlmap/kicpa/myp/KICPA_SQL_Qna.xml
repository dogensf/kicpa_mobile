<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Qna">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias  alias="qna" type="adminwork.kicpa.qna.service.Qna"/>
    <typeAlias  alias="qnaVO" type="adminwork.kicpa.qna.service.QnaVO"/>
	<typeAlias  alias="comDefaultVO" type="adminwork.com.cmm.ComDefaultVO"/>
		
		
		
	<insert id="QnaDAO.insertQna" parameterClass="qnaVO" >
		<![CDATA[
			INSERT INTO CS_QNA
			(qna_id,pin,category,job,reg_email,reg_dt,depart,manager,manager_email,qna_sj,qna_cn,atch_file_id,status,del_yn)
			VALUES
			( #qna_id#,#pin#,#category#,#job#,#reg_email#,SYSDATE,#depart#,#manager#,#manager_email#,#qna_sj#,#qna_cn#,#atch_file_id#,'접수','N')			
		]]>
	</insert>	
	
	
	<select id="QnaDAO.selectQnaList" parameterClass="qnaVO" resultClass="qna">
		<![CDATA[
		SELECT * FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.qna_id,
				a.pin,
				a.category,
				a.job,
				a.reg_email,
				TO_CHAR(a.reg_dt, 'YYYY-MM-DD') as reg_dt,
				a.depart,
				a.manager,
				a.manager_email,
				a.qna_sj,
				a.qna_cn,
				a.atch_file_id,
				a.status,
				a.answer_ty,
				a.answer_cn,
				TO_CHAR(a.answer_dt, 'YYYY-MM-DD') as answer_dt,
				a.answer_id,
				a.del_yn
							
			FROM
				CS_QNA a			 
			WHERE
				a.DEL_YN = 'N'
			AND a.PIN = #pin#	
		]]>
			<isNotEmpty property="category">
				AND a.category = #category#
			</isNotEmpty>
			<isNotEmpty property="job">
				AND a.job = #job#
			</isNotEmpty>
			<isNotEmpty property="status">
				AND a.status = #status#
			</isNotEmpty>
			<isNotEmpty property="searchCnd">
				<isEqual prepend="AND" property="searchCnd" compareValue="0">
					<![CDATA[	a.qna_sj LIKE '%' || #searchWrd# || '%' 		]]>
				</isEqual>
				<isEqual prepend="AND" property="searchCnd" compareValue="1">
					<![CDATA[	a.manager LIKE '%' || #searchWrd# || '%' 		]]>
				</isEqual>	
				<isEqual prepend="AND" property="searchCnd" compareValue="2">
					<![CDATA[	b.depart LIKE '%' || #searchWrd# || '%' 		]]>
				</isEqual>		
			</isNotEmpty>		
		<![CDATA[			
			ORDER BY a.reg_dt DESC
			) TB ) WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
		]]>				
	</select>	
	
	<select id="QnaDAO.selectQnaListCnt" parameterClass="qnaVO" resultClass="java.lang.Integer">
		<![CDATA[
		
			SELECT
				COUNT(a.qna_ID)				
			FROM
				CS_QNA a			 
			WHERE
				DEL_YN = 'N'
			AND a.PIN = #pin#
		]]>
			<isNotEmpty property="category">
				AND a.category = #category#
			</isNotEmpty>		
			<isNotEmpty property="job">
				AND a.job = #job#
			</isNotEmpty>
			<isNotEmpty property="status">
				AND a.status = #status#
			</isNotEmpty>
			<isNotEmpty property="searchCnd">
				<isEqual prepend="AND" property="searchCnd" compareValue="0">
					<![CDATA[	a.qna_sj LIKE '%' || #searchWrd# || '%' 		]]>
				</isEqual>
				<isEqual prepend="AND" property="searchCnd" compareValue="1">
					<![CDATA[	a.manager LIKE '%' || #searchWrd# || '%' 		]]>
				</isEqual>	
				<isEqual prepend="AND" property="searchCnd" compareValue="2">
					<![CDATA[	b.depart LIKE '%' || #searchWrd# || '%' 		]]>
				</isEqual>			
			</isNotEmpty>
		<![CDATA[			
			ORDER BY a.reg_dt DESC
		]]>				
	</select>
	

	
	<select id="QnaDAO.selectQna" parameterClass="qnaVO" resultClass="qna" >
		<![CDATA[
		SELECT *
		FROM (
			SELECT
				    a.qna_id,
				    a.pin,
					a.category,
					a.job,
					a.reg_email,
					TO_CHAR(a.reg_dt, 'YYYY-MM-DD') as reg_dt,
					a.depart,
					a.manager,
					a.manager_email,
					a.qna_sj,
					a.qna_cn,
					a.atch_file_id,
					a.status,
					a.answer_ty,
					a.answer_cn,
					TO_CHAR(a.answer_dt, 'YYYY-MM-DD') as answer_dt,
					a.answer_id,
					a.del_yn,
   			        LEAD(a.qna_id, 1) OVER (ORDER BY a.reg_dt DESC) AS next_id,
   			        LAG(a.qna_id, 1) OVER (ORDER BY a.reg_dt DESC) AS pre_id
			FROM
				CS_QNA a						
			WHERE				
				a.DEL_YN = 'N'
		)A
		WHERE 
		     a.Qna_ID = #qna_id#		
		 AND a.PIN    = #pin#	 		
				
		]]>				
	</select> 
	
	
	
	
	
	
 

</sqlMap>
